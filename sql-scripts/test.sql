select * from TIMETABLE

select a.*, LEVEL
  from ROUTE_NODES a--, TIMETABLE t
--  WHERE a.ID = t.ROUTE_NODE_ID
--  START WITH a.DEPARTURE_STATION_ID = 1
  CONNECT BY PRIOR a.NEXT_ID = a.ID
  
SELECT --DEPARTURE_STATION_ID,
MIN(DEPARTURE_STATION_ID) KEEP (DENSE_RANK FIRST ORDER BY a.DEPARTURE_STATION_ID) "Worst",
MAX(DEPARTURE_STATION_ID) KEEP (DENSE_RANK LAST ORDER BY a.DEPARTURE_STATION_ID) "Best"
   FROM ROUTE_NODES a
   CONNECT BY PRIOR a.NEXT_ID = a.ID
 --  GROUP BY a.DEPARTURE_STATION_ID
   
SELECT DISTINCT * from 
(
  select a.DEPARTURE_STATION_ID as DEPARTURE_STATION_ID
    from ROUTE_NODES a
    WHERE LEVEL = 1
    START WITH a.DEPARTURE_STATION_ID = 1
    CONNECT BY PRIOR a.NEXT_ID = a.ID
    ORDER SIBLINGS BY DEPARTURE_STATION_ID
) startStation,
(
  select a.ARRIVAL_STATION_ID as ARRIVAL_STATION_ID, LEVEL
    from ROUTE_NODES a
    WHERE NEXT_ID IS NULL 
    START WITH a.DEPARTURE_STATION_ID = 3
    CONNECT BY a.ID = PRIOR a.NEXT_ID
    ORDER BY LEVEL
) endStation
WHERE startStation



 select DEPARTURE_STATION_ID, a.ARRIVAL_STATION_ID as ARRIVAL_STATION_ID, LEVEL
    from ROUTE_NODES a
    WHERE NEXT_ID IS NULL 
    START WITH a.DEPARTURE_STATION_ID = 3
    CONNECT BY a.ID = PRIOR a.NEXT_ID
    ORDER BY LEVEL





















SELECT DISTINCT * FROM TIMETABLE a, TRAINS t, ROUTES r,
  (SELECT DISTINCT st.* FROM STATIONS st, SEGMENTS sg, ROUTES_2_SEGMENTS rs, ROUTES r
  WHERE rs.SEGMENT_ID = sg.ID
  AND rs.ROUTE_ID = r.ID
  AND (sg.DEPARTURE_STATION_ID = st.ID OR (sg.ARRIVAL_STATION_ID = st.ID AND rs.IS_TERMINAL <> 1))
  AND r.ACTIVE = 1) DEPARTURE_ST
  WHERE a.ROUTE_ID = r.ID AND
        a.TRAIN_ID = t.ID
        AND r.ACTIVE = 1




--tutte le Stazioni di partenza delle tratte
SELECT DISTINCT st.* FROM STATIONS st, SEGMENTS sg, ROUTES_2_SEGMENTS rs, ROUTES r
  WHERE rs.SEGMENT_ID = sg.ID
  AND rs.ROUTE_ID = r.ID
  AND (sg.DEPARTURE_STATION_ID = st.ID OR (sg.ARRIVAL_STATION_ID = st.ID AND rs.PERFORM_STOP = 1 AND rs.IS_TERMINAL = 0))
  AND r.ACTIVE = 1



--tutte le Stazioni di arrivo delle tratte
SELECT DISTINCT st.* FROM STATIONS st, SEGMENTS sg, ROUTES_2_SEGMENTS rs, ROUTES r
  WHERE rs.SEGMENT_ID = sg.ID
  AND rs.ROUTE_ID = r.ID
  AND (sg.ARRIVAL_STATION_ID = st.ID OR (sg.DEPARTURE_STATION_ID = st.ID AND rs.PERFORM_STOP = 1 AND rs.IS_TERMINAL = 0))
  AND r.ACTIVE = 1